lem_engagement\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n            ),\n            problem_engagement as (\n                select *\n                from subsection_engagement\n                union all\n                select *\n                from section_engagement\n            )\n        select\n            pe.org as org,\n            pe.course_key as course_key,\n            course_blocks.course_run as course_run,\n            course_blocks.display_name_with_location as section_subsection_name,\n            pe.content_level as content_level,\n            pe.actor_id as actor_id,\n            pe.section_subsection_problem_engagement\n            as section_subsection_problem_engagement,\n            users.username as username,\n            users.name as name,\n            users.email as email\n        from problem_engagement pe\n        join\n            reporting.dim_course_blocks course_blocks\n            on (\n                pe.org = course_blocks.org\n                and pe.course_key = course_blocks.course_key\n                and pe.block_id = course_blocks.block_id\n            )\n        left outer join\n            reporting.dim_user_pii users\n            on (pe.actor_id like \'mailto:%\' and SUBSTRING(pe.actor_id, 8) = users.email)\n            or pe.actor_id = toString(users.external_user_id)\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    )\nselect fact_problem_engagement.*\nfrom fact_problem_engagement pe\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners\n    on (\n        pe.org = at_risk_learners.org\n        and pe.course_key = at_risk_learners.course_key\n        and pe.actor_id = at_risk_learners.actor_id\n    )\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_problem_engagement_da](id:569)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary 'åŠš‚¤³R<†:U\êb¡,',0,NULL,1,0),('2025-01-10 06:45:40','2025-01-14 07:53:09',570,'watched_video_duration_en',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    course_keys as (\n        select [] as course_key\n        {% if filter_values(\"course_name\") != [] %}\n            union all\n            select array(course_key) as course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        {% endif %}\n        {% if filter_values(\"tag\") != [] %}\n            union distinct\n            select array(course_key) as course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        {% endif %}\n    )\nselect\n    names.org as org,\n    names.course_key as course_key,\n    names.course_name as course_name,\n    names.course_run as course_run,\n    actor_id,\n    video_count,\n    video_duration,\n    watched_time,\n    rewatched_time,\n    object_id\nfrom\n    reporting.watched_video_duration(\n        org_filter = coalesce({{ filter_values(\"org\") }}, []),\n        course_key_filter\n        = coalesce((select array_concat_agg(course_key) from course_keys), [])\n    ) as a\nleft join\n    event_sink.course_names as names\n    on a.org = names.org\n    and a.course_key = names.course_key\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[watched_video_duration_en](id:570)',1,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]',NULL,_binary 'HgM×¨_¤“¸8\Å\×g\ÎV',0,NULL,1,0),('2025-01-10 06:45:40','2025-01-14 07:53:09',571,'fact_at_risk_video_watches_id',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    watches as (\n        with\n            watched_segments as (\n                with\n                    video_events as (\n                        select\n                            emission_time,\n                            org,\n                            course_key,\n                            splitByString(\'/xblock/\', object_id)[-1] as video_id,\n                            object_id,\n                            actor_id,\n                            verb_id,\n                            video_position,\n                            video_duration\n                        from xapi.video_playback_events\n                        where\n                            1 = 1\n                            {% if filter_values(\"org\") != [] %}\n                                and org in {{ filter_values(\"org\") | where_in }}\n                            {% endif %}\n\n                            {% if filter_values(\"course_name\") != [] %}\n                                and course_key in (\n                                    select course_key\n                                    from event_sink.course_names\n                                    where\n                                        course_name\n                                        in {{ filter_values(\"course_name\") | where_in }}\n                                )\n                            {% endif %}\n\n                            {% if filter_values(\"tag\") != [] %}\n                                and course_key in (\n                                    select course_key\n                                    from reporting.most_recent_course_tags\n                                    where\n                                        tag in (\n                                            select\n                                                replaceAll(\n                                                    arrayJoin(\n                                                        {{ filter_values(\"tag\") }}\n                                                    ),\n                                                    \'- \',\n                                                    \'\'\n                                                )\n                                        )\n                                )\n                            {% endif %}\n                    ),\n                    starts as (\n                        select *\n                        from video_events\n                        where verb_id = \'https://w3id.org/xapi/video/verbs/played\'\n                    ),\n                    ends as (\n                        select *\n                        from video_events\n                        where\n                            verb_id in (\n                                \'http://adlnet.gov/expapi/verbs/completed\',\n                                \'https://w3id.org/xapi/video/verbs/seeked\',\n                                \'https://w3id.org/xapi/video/verbs/paused\',\n                                \'http://adlnet.gov/expapi/verbs/terminated\'\n                            )\n                    ),\n                    segments as (\n                        select\n                            starts.org as org,\n                            starts.course_key as course_key,\n                            starts.video_id as video_id,\n                            starts.actor_id,\n                            starts.object_id as object_id,\n                            cast(starts.video_position as Int32) as start_position,\n                            cast(ends.video_position as Int32) as end_position,\n                            starts.emission_time as started_at,\n                            ends.emission_time as ended_at,\n                            ends.verb_id as end_type,\n                            starts.video_duration as video_duration\n                        from starts left\n                        asof join\n                            ends\n                            on (\n                                starts.org = ends.org\n                                and starts.course_key = ends.course_key\n                                and starts.video_id = ends.video_id\n                                and starts.actor_id = ends.actor_id\n                                and starts.emission_time < ends.emission_time\n                            )\n                    ),\n                    enriched_segments as (\n                        select\n                            segments.org as org,\n                            segments.course_key as course_key,\n                            blocks.course_name as course_name,\n                            blocks.course_run as course_run,\n                            blocks.section_with_name as section_with_name,\n                            blocks.subsection_with_name as subsection_with_name,\n                            blocks.block_name as video_name,\n                            blocks.display_name_with_location\n                            as video_name_with_location,\n                            segments.actor_id as actor_id,\n                            segments.object_id as object_id,\n                            segments.started_at as started_at,\n                            segments.start_position\n                            - (segments.start_position % 5) as start_position,\n                            segments.end_position\n                            - (segments.end_position % 5) as end_position,\n                            segments.video_duration as video_duration,\n                            segments.video_id as video_id\n                        from segments\n                        join\n                            reporting.dim_course_blocks_extended blocks\n                            on (\n                                segments.course_key = blocks.course_key\n                                and segments.video_id = blocks.block_id\n                            )\n                        where\n                            1 = 1\n                            {% if filter_values(\"org\") != [] %}\n                                and org in {{ filter_values(\"org\") | where_in }}\n                            {% endif %}\n\n                            {% if filter_values(\"course_name\") != [] %}\n                                and course_key in (\n                                    select course_key\n                                    from event_sink.course_names\n                                    where\n                                        course_name\n                                        in {{ filter_values(\"course_name\") | where_in }}\n                                )\n                            {% endif %}\n\n                            {% if filter_values(\"tag\") != [] %}\n                                and course_key in (\n                                    select course_key\n                                    from reporting.most_recent_course_tags\n                                    where\n                                        tag in (\n                                            select\n                                                replaceAll(\n                                                    arrayJoin(\n                                                        {{ filter_values(\"tag\") }}\n                                                    ),\n                                                    \'- \',\n                                                    \'\'\n                                                )\n                                        )\n                                )\n                            {% endif %}\n                    )\n\n                select\n                    org,\n                    course_key,\n                    course_name,\n                    course_run,\n                    section_with_name,\n                    subsection_with_name,\n                    video_name,\n                    video_name_with_location,\n                    video_id,\n                    concat(\n                        \'<a href=\"\',\n                        object_id,\n                        \'\" target=\"_blank\">\',\n                        video_name_with_location,\n                        \'</a>\'\n                    ) as video_link,\n                    actor_id,\n                    started_at,\n                    arrayJoin(range(start_position, end_position, 5)) as segment_start,\n                    video_duration,\n                    CONCAT(\n                        toString(segment_start), \'-\', toString(segment_start + 4)\n                    ) as segment_range,\n                    start_position,\n                    username,\n                    name,\n                    email\n                from enriched_segments\n                left outer join\n                    reporting.dim_user_pii users\n                    on (\n                        actor_id like \'mailto:%\'\n                        and SUBSTRING(actor_id, 8) = users.email\n                    )\n                    or actor_id = toString(users.external_user_id)\n                order by segment_start\n            )\n\n        select\n            org,\n            course_key,\n            course_name,\n            course_run,\n            section_with_name,\n            subsection_with_name,\n            video_name,\n            video_name_with_location,\n            video_link,\n            actor_id,\n            username,\n            email,\n            name,\n            count(distinct segment_start) as watched_segment_count,\n            (video_duration - 10) / 5 as video_segment_count,\n            video_segment_count <= watched_segment_count as watched_entire_video\n        from watched_segments\n        where\n            1 = 1\n\n            {% if filter_values(\"Section Name\") != [] %}\n                and section_with_name in {{ filter_values(\"Section Name\") | where_in }}\n            {% endif %}\n            {% if filter_values(\"Subsection Name\") != [] %}\n                and subsection_with_name\n                in {{ filter_values(\"Subsection Name\") | where_in }}\n            {% endif %}\n            {% if from_dttm %} and started_at > \'{{ from_dttm }}\' {% endif %}\n            {% if to_dttm %} and started_at < \'{{ to_dttm }}\' {% endif %}\n\n        group by\n            org,\n            course_key,\n            course_name,\n            course_run,\n            section_with_name,\n            subsection_with_name,\n            video_name,\n            video_name_with_location,\n            video_link,\n            actor_id,\n            video_id,\n            video_segment_count,\n            username,\n            email,\n            name\n    )\n\nselect watches.*\nfrom watches\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners using (org, course_key, actor_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_video_watches_id](id:571)',0,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]','{}',_binary 'B\"\ÜTE\ÙSe—”–p¶l\ß\è',0,NULL,1,0),('2025-01-10 06:45:40','2025-01-14 07:53:09',572,'enrollment_status_it_IT','emission_time',NULL,1,1,1,0,NULL,0,NULL,'reporting','select\n    fes.org,\n    fes.course_key,\n    fes.actor_id,\n    fes.enrollment_status,\n    fes.enrollment_mode,\n    fes.emission_time,\n    cn.course_name,\n    cn.course_run\nfrom reporting.fact_enrollment_status fes\nleft join\n    event_sink.course_names cn on fes.org = cn.org and fes.course_key = cn.course_key\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[enrollment_status_it_IT](id:572)',1,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]',NULL,_binary 'F\'¯\óÌ„UÍ´9‹¿::f\à',0,NULL,0,0),('2025-01-10 06:45:40','2025-01-14 07:53:09',573,'clickhouse_computed_metrics_es_ES',NULL,NULL,1,1,1,0,NULL,0,NULL,'system','select name, toFloat64(value) as value, description\nfrom system.metrics\nwhere metric in (\'Query\', \'DelayedInserts\', \'DistributedFilesToInsert\')\n\nunion all\n\nselect metric as name, round(toFloat64(value), 2) as value, description\nfrom system.asynchronous_metrics\nwhere metric in (\'MaxPartCountForPartition\', \'Uptime\')\n\nunion all\n\nselect name, toFloat64(value) as value, description\nfrom system.events\nwhere\n    event in (\n        \'RejectedInserts\',\n        \'ReplicatedDataLoss\',\n        \'DataAfterMergeDiffersFromReplica\',\n        \'DataAfterMutationDiffersFromReplica\'\n    )\n\nunion all\n\nselect\n    \'StuckReplicationTasks\' as name,\n    toFloat64(count()) as value,\n    \'Replication tasks that were retried or postponed over 100 times.\' as description\nfrom system.replication_queue\nwhere num_tries > 100 or num_postponed > 100\n\nunion all\n\nselect\n    CONCAT(\'cluster \', name) as name,\n    ROUND(SUM(free_space) / SUM(total_space), 3) * 100 as value,\n    \'Free space per cluster node, as percent\' as description\nfrom system.disks\ngroup by name\n',NULL,'[OpenedX Clickhouse].[clickhouse_computed_metrics_es_ES](id:573)',1,NULL,0,NULL,'[OpenedX Clickhouse].[system]','{}',_binary '¸\n›—\ÙY	©8HF€/\î',0,NULL,0,0),('2025-01-10 06:45:40','2025-01-14 07:53:09',574,'fact_video_watches_hi',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    watched_segments as (\n        with\n            video_events as (\n                select\n                    emission_time,\n                    org,\n                    course_key,\n                    splitByString(\'/xblock/\', object_id)[-1] as video_id,\n                    object_id,\n                    actor_id,\n                    verb_id,\n                    video_position,\n                    video_duration\n                from xapi.video_playback_events\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n            ),\n            starts as (\n                select *\n                from video_events\n                where verb_id = \'https://w3id.org/xapi/video/verbs/played\'\n            ),\n            ends as (\n                select *\n                from video_events\n                where\n                    verb_id in (\n                        \'http://adlnet.gov/expapi/verbs/completed\',\n                        \'https://w3id.org/xapi/video/verbs/seeked\',\n                        \'https://w3id.org/xapi/video/verbs/paused\',\n                        \'http://adlnet.gov/expapi/verbs/terminated\'\n                    )\n            ),\n            segments as (\n                select\n                    starts.org as org,\n                    starts.course_key as course_key,\n                    starts.video_id as video_id,\n                    starts.actor_id,\n                    starts.object_id as object_id,\n                    cast(starts.video_position as Int32) as start_position,\n                    cast(ends.video_position as Int32) as end_position,\n                    starts.emission_time as started_at,\n                    ends.emission_time as ended_at,\n                    ends.verb_id as end_type,\n                    starts.video_duration as video_duration\n                from starts left\n                asof join\n                    ends\n                    on (\n                        starts.org = ends.org\n                        and starts.course_key = ends.course_key\n                        and starts.video_id = ends.video_id\n                        and starts.actor_id = ends.actor_id\n                        and starts.emission_time < ends.emission_time\n                    )\n            ),\n            enriched_segments as (\n                select\n                    segments.org as org,\n                    segments.course_key as course_key,\n                    blocks.course_name as course_name,\n                    blocks.course_run as course_run,\n                    blocks.section_with_name as section_with_name,\n                    blocks.subsection_with_name as subsection_with_name,\n                    blocks.block_name as video_name,\n                    blocks.display_name_with_location as video_name_with_location,\n                    segments.actor_id as actor_id,\n                    segments.object_id as object_id,\n                    segments.started_at as started_at,\n                    segments.start_position\n                    - (segments.start_position % 5) as start_position,\n                    segments.end_position - (segments.end_position % 5) as end_position,\n                    segments.video_duration as video_duration,\n                    segments.video_id as video_id\n                from segments\n                join\n                    reporting.dim_course_blocks_extended blocks\n                    on (\n                        segments.course_key = blocks.course_key\n                        and segments.video_id = blocks.block_id\n                    )\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n            )\n\n        select\n            org,\n            course_key,\n            course_name,\n            course_run,\n            section_with_name,\n            subsection_with_name,\n            video_name,\n            video_name_with_location,\n            video_id,\n            concat(\n                \'<a href=\"\',\n                object_id,\n                \'\" target=\"_blank\">\',\n                video_name_with_location,\n                \'</a>\'\n            ) as video_link,\n            actor_id,\n            started_at,\n            arrayJoin(range(start_position, end_position, 5)) as segment_start,\n            video_duration,\n            CONCAT(\n                toString(segment_start), \'-\', toString(segment_start + 4)\n            ) as segment_range,\n            start_position,\n            username,\n            name,\n            email\n        from enriched_segments\n        left outer join\n            reporting.dim_user_pii users\n            on (actor_id like \'mailto:%\' and SUBSTRING(actor_id, 8) = users.email)\n            or actor_id = toString(users.external_user_id)\n        order by segment_start\n    )\n\nselect\n    org,\n    course_key,\n    course_name,\n    course_run,\n    section_with_name,\n    subsection_with_name,\n    video_name,\n    video_name_with_location,\n    video_link,\n    actor_id,\n    username,\n    email,\n    name,\n    count(distinct segment_start) as watched_segment_count,\n    (video_duration - 10) / 5 as video_segment_count,\n    video_segment_count <= watched_segment_count as watched_entire_video\nfrom watched_segments\nwhere\n    1 = 1\n\n    {% if filter_values(\"Section Name\") != [] %}\n        and section_with_name in {{ filter_values(\"Section Name\") | where_in }}\n    {% endif %}\n    {% if filter_values(\"Subsection Name\") != [] %}\n        and subsection_with_name in {{ filter_values(\"Subsection Name\") | where_in }}\n    {% endif %}\n    {% if from_dttm %} and started_at > \'{{ from_dttm }}\' {% endif %}\n    {% if to_dttm %} and started_at < \'{{ to_dttm }}\' {% endif %}\n\ngroup by\n    org,\n    course_key,\n    course_name,\n    course_run,\n    section_with_name,\n    subsection_with_name,\n    video_name,\n    video_name_with_location,\n    video_link,\n    actor_id,\n    video_id,\n    video_segment_count,\n    username,\n    email,\n    name\n',NULL,'[OpenedX Clickhouse].[fact_video_watches_hi](id:574)',0,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]','{}',_binary '^;/Sø[Z¡€ýø0Nƒ',0,NULL,1,0),('2025-01-10 06:45:41','2025-01-14 07:53:09',575,'fact_at_risk_video_engagement_el',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','select fact_video_engagement.*\nfrom reporting.fact_video_engagement\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners using (org, course_key, actor_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_video_engagement_el](id:575)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary 'O#”\ÅS\ó¹1H8‚©©\Ü',0,NULL,1,0),('2025-01-10 06:45:41','2025-01-14 07:53:09',576,'fact_pageview_engagement_ar',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    subsection_engagement as (\n        select\n            org,\n            course_key,\n            \'subsection\' as content_level,\n            actor_id,\n            subsection_block_id as block_id,\n            engagement_level as section_subsection_page_engagement\n        from xapi.subsection_page_engagement\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ),\n    section_engagement as (\n        select\n            org,\n            course_key,\n            \'section\' as content_level,\n            actor_id,\n            section_block_id as block_id,\n            engagement_level as section_subsection_page_engagement\n        from xapi.section_page_engagement\n    ),\n    page_engagement as (\n        select *\n        from subsection_engagement\n        union all\n        select *\n        from section_engagement\n    )\n\nselect\n    pv.org as org,\n    pv.course_key as course_key,\n    course_blocks.course_run as course_run,\n    course_blocks.display_name_with_location as section_subsection_name,\n    pv.content_level as content_level,\n    pv.actor_id as actor_id,\n    pv.section_subsection_page_engagement as section_subsection_page_engagement,\n    users.username as username,\n    users.name as name,\n    users.email as email\nfrom page_engagement pv\njoin\n    reporting.dim_course_blocks course_blocks\n    on (\n        pv.org = course_blocks.org\n        and pv.course_key = course_blocks.course_key\n        and pv.block_id = course_blocks.block_id\n    )\nleft outer join\n    reporting.dim_user_pii users\n    on (pv.actor_id like \'mailto:%\' and SUBSTRING(pv.actor_id, 8) = users.email)\n    or pv.actor_id = toString(users.external_user_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_pageview_engagement_ar](id:576)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary 'r×‡h\Ê9];Š¬ÕœD',0,NULL,1,0),('2025-01-10 06:45:41','2025-01-14 07:53:09',577,'clickhouse_computed_metrics_en',NULL,NULL,1,1,1,0,NULL,0,NULL,'system','select name, toFloat64(value) as value, description\nfrom system.metrics\nwhere metric in (\'Query\', \'DelayedInserts\', \'DistributedFilesToInsert\')\n\nunion all\n\nselect metric as name, round(toFloat64(value), 2) as value, description\nfrom system.asynchronous_metrics\nwhere metric in (\'MaxPartCountForPartition\', \'Uptime\')\n\nunion all\n\nselect name, toFloat64(value) as value, description\nfrom system.events\nwhere\n    event in (\n        \'RejectedInserts\',\n        \'ReplicatedDataLoss\',\n        \'DataAfterMergeDiffersFromReplica\',\n        \'DataAfterMutationDiffersFromReplica\'\n    )\n\nunion all\n\nselect\n    \'StuckReplicationTasks\' as name,\n    toFloat64(count()) as value,\n    \'Replication tasks that were retried or postponed over 100 times.\' as description\nfrom system.replication_queue\nwhere num_tries > 100 or num_postponed > 100\n\nunion all\n\nselect\n    CONCAT(\'cluster \', name) as name,\n    ROUND(SUM(free_space) / SUM(total_space), 3) * 100 as value,\n    \'Free space per cluster node, as percent\' as description\nfrom system.disks\ngroup by name\n',NULL,'[OpenedX Clickhouse].[clickhouse_computed_metrics_en](id:577)',1,NULL,0,NULL,'[OpenedX Clickhouse].[system]','{}',_binary '\ÏD\rt¥6Z\÷½\Ö	½\ì\Ú6\Ù',0,NULL,0,0),('2025-01-10 06:45:41','2025-01-14 07:53:09',578,'fact_at_risk_pageview_engagement_id',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','select fact_pageview_engagement.*\nfrom reporting.fact_pageview_engagement\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners using (org, course_key, actor_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_pageview_engagement_id](id:578)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary '\áF$+Sl \Ôt\ÐL\ê‰\÷',0,NULL,1,0),('2025-01-10 06:45:41','2025-01-14 07:53:09',579,'watched_video_duration_zh_CN',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    course_keys as (\n        select [] as course_key\n        {% if filter_values(\"course_name\") != [] %}\n            union all\n            select array(course_key) as course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        {% endif %}\n        {% if filter_values(\"tag\") != [] %}\n            union distinct\n            select array(course_key) as course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        {% endif %}\n    )\nselect\n    names.org as org,\n    names.course_key as course_key,\n    names.course_name as course_name,\n    names.course_run as course_run,\n    actor_id,\n    video_count,\n    video_duration,\n    watched_time,\n    rewatched_time,\n    object_id\nfrom\n    reporting.watched_video_duration(\n        org_filter = coalesce({{ filter_values(\"org\") }}, []),\n        course_key_filter\n        = coalesce((select array_concat_agg(course_key) from course_keys), [])\n    ) as a\nleft join\n    event_sink.course_names as names\n    on a.org = names.org\n    and a.course_key = names.course_key\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name
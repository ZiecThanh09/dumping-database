_id = ends.video_id\n                        and starts.actor_id = ends.actor_id\n                        and starts.emission_time < ends.emission_time\n                    )\n            ),\n            enriched_segments as (\n                select\n                    segments.org as org,\n                    segments.course_key as course_key,\n                    blocks.course_name as course_name,\n                    blocks.course_run as course_run,\n                    blocks.section_with_name as section_with_name,\n                    blocks.subsection_with_name as subsection_with_name,\n                    blocks.block_name as video_name,\n                    blocks.display_name_with_location as video_name_with_location,\n                    segments.actor_id as actor_id,\n                    segments.object_id as object_id,\n                    segments.started_at as started_at,\n                    segments.start_position\n                    - (segments.start_position % 5) as start_position,\n                    segments.end_position - (segments.end_position % 5) as end_position,\n                    segments.video_duration as video_duration,\n                    segments.video_id as video_id\n                from segments\n                join\n                    reporting.dim_course_blocks_extended blocks\n                    on (\n                        segments.course_key = blocks.course_key\n                        and segments.video_id = blocks.block_id\n                    )\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n            )\n\n        select\n            org,\n            course_key,\n            course_name,\n            course_run,\n            section_with_name,\n            subsection_with_name,\n            video_name,\n            video_name_with_location,\n            video_id,\n            concat(\n                \'<a href=\"\',\n                object_id,\n                \'\" target=\"_blank\">\',\n                video_name_with_location,\n                \'</a>\'\n            ) as video_link,\n            actor_id,\n            started_at,\n            arrayJoin(range(start_position, end_position, 5)) as segment_start,\n            video_duration,\n            CONCAT(\n                toString(segment_start), \'-\', toString(segment_start + 4)\n            ) as segment_range,\n            start_position,\n            username,\n            name,\n            email\n        from enriched_segments\n        left outer join\n            reporting.dim_user_pii users\n            on (actor_id like \'mailto:%\' and SUBSTRING(actor_id, 8) = users.email)\n            or actor_id = toString(users.external_user_id)\n        order by segment_start\n    )\n\nselect watches.*\nfrom watches\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners using (org, course_key, actor_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_watched_video_segments_id](id:275)',0,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]','{}',_binary '\ÿsY\00\Û_≤Ωên	\∆\Á',0,NULL,1,0),('2025-01-10 06:45:12','2025-01-14 07:52:48',276,'fact_at_risk_video_engagement_hi',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','select fact_video_engagement.*\nfrom reporting.fact_video_engagement\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners using (org, course_key, actor_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_video_engagement_hi](id:276)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary 'ûFÿÇRcû\≈\n\ﬁ\ÁL',0,NULL,1,0),('2025-01-10 06:45:12','2025-01-14 07:52:49',277,'clickhouse_computed_metrics_da',NULL,NULL,1,1,1,0,NULL,0,NULL,'system','select name, toFloat64(value) as value, description\nfrom system.metrics\nwhere metric in (\'Query\', \'DelayedInserts\', \'DistributedFilesToInsert\')\n\nunion all\n\nselect metric as name, round(toFloat64(value), 2) as value, description\nfrom system.asynchronous_metrics\nwhere metric in (\'MaxPartCountForPartition\', \'Uptime\')\n\nunion all\n\nselect name, toFloat64(value) as value, description\nfrom system.events\nwhere\n    event in (\n        \'RejectedInserts\',\n        \'ReplicatedDataLoss\',\n        \'DataAfterMergeDiffersFromReplica\',\n        \'DataAfterMutationDiffersFromReplica\'\n    )\n\nunion all\n\nselect\n    \'StuckReplicationTasks\' as name,\n    toFloat64(count()) as value,\n    \'Replication tasks that were retried or postponed over 100 times.\' as description\nfrom system.replication_queue\nwhere num_tries > 100 or num_postponed > 100\n\nunion all\n\nselect\n    CONCAT(\'cluster \', name) as name,\n    ROUND(SUM(free_space) / SUM(total_space), 3) * 100 as value,\n    \'Free space per cluster node, as percent\' as description\nfrom system.disks\ngroup by name\n',NULL,'[OpenedX Clickhouse].[clickhouse_computed_metrics_da](id:277)',1,NULL,0,NULL,'[OpenedX Clickhouse].[system]','{}',_binary 'î¶öö`\’Sî:ú>ΩäR',0,NULL,0,0),('2025-01-10 06:45:12','2025-01-14 07:52:49',278,'query_log_fr_CA',NULL,NULL,1,1,1,0,NULL,0,NULL,'system','select\n    query_duration_ms,\n    result_rows,\n    memory_usage / (1024 * 1024) as memory_usage_mb,\n    event_time,\n    tables,\n    query,\n    http_user_agent\nfrom system.query_log\nwhere\n    (\n        has(databases, \'xapi\')\n        or has(databases, \'event_sink\')\n        or has(databases, \'reporting\')\n    )\n    and (http_user_agent like \'aspects-%\')\n    and (type = \'QueryFinish\')\norder by event_time DESC\n',NULL,'[OpenedX Clickhouse].[query_log_fr_CA](id:278)',1,NULL,0,NULL,'[OpenedX Clickhouse].[system]',NULL,_binary '\Í`c2\œ]π≥\›\ı˚\'ñ∞\‡',0,NULL,0,0),('2025-01-10 06:45:12','2025-01-14 07:52:49',279,'fact_at_risk_pageview_engagement_da',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','select fact_pageview_engagement.*\nfrom reporting.fact_pageview_engagement\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners using (org, course_key, actor_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_pageview_engagement_da](id:279)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary '¯∞Ä\ÿø]\ÛñWï:â”ûJ',0,NULL,1,0),('2025-01-10 06:45:12','2025-01-14 07:52:49',280,'fact_at_risk_pageview_engagement_tr_TR',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','select fact_pageview_engagement.*\nfrom reporting.fact_pageview_engagement\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners using (org, course_key, actor_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_pageview_engagement_tr_TR](id:280)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary 'ù•\Îß\[⁄Åî\ˆKœ∫\“',0,NULL,1,0),('2025-01-10 06:45:12','2025-01-14 07:52:49',281,'fact_navigation_completion_he','visited_on',NULL,1,1,1,0,NULL,0,NULL,'reporting','select *\nfrom reporting.fact_navigation_completion\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_navigation_completion_he](id:281)',1,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]',NULL,_binary 'éç>G\\\Ëí\⁄;ÿïà\˜\Õ',0,NULL,0,0),('2025-01-10 06:45:12','2025-01-14 07:52:49',282,'fact_enrollments_th','emission_time',NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    enrollments_base as (\n        select *\n        from reporting.fact_enrollments\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    )\n\nselect\n    emission_time,\n    org,\n    course_key,\n    course_name,\n    course_run,\n    actor_id,\n    enrollment_mode,\n    enrollment_status\nfrom enrollments_base\n',NULL,'[OpenedX Clickhouse].[fact_enrollments_th](id:282)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]','{}',_binary '{\‚%\Ú`Z>óUπªw@',0,NULL,1,0),('2025-01-10 06:45:12','2025-01-14 07:52:49',283,'fact_video_plays_zh_CN','emission_time',NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    plays as (\n        select *\n        from reporting.fact_video_plays\n        where\n\n            {% if get_filters(\"course_name\", remove_filter=True) == [] %} 1 = 1\n            {% elif filter_values(\"course_name\") != [] %}\n                course_name in {{ filter_values(\"course_name\") | where_in }}\n            {% else %} 1 = 0\n            {% endif %}\n\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    )\n\nselect *\nfrom plays\n',NULL,'[OpenedX Clickhouse].[fact_video_plays_zh_CN](id:283)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]','{}',_binary '\»œê	˘XµSA]ÄáÅ',0,NULL,1,0),('2025-01-10 06:45:12','2025-01-14 07:52:49',284,'learner_summary_tr_TR','emission_time',NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    latest_emission_time as (\n        select org, course_key, actor_id, MAX(emission_time) as last_visited\n        from xapi.fact_learner_last_course_visit\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n            {% if filter_values(\"username\") != [] or filter_values(\n                \"name\"\n            ) != [] or filter_values(\"email\") != [] %}\n                and actor_id in (\n                    select external_user_id::String\n                    from event_sink.user_pii\n                    where\n                        1 = 1\n                        {% if filter_values(\"username\") != [] %}\n                            and username in {{ filter_values(\"username\") | where_in }}\n                        {% endif %}\n                        {% if filter_values(\"name\") != [] %}\n                            and name in {{ filter_values(\"name\") | where_in }}\n                        {% endif %}\n                        {% if filter_values(\"email\") != [] %}\n                            and email in {{ filter_values(\"email\") | where_in }}\n                        {% endif %}\n                )\n            {% endif %}\n        group by org, course_key, actor_id\n    ),\n    enrollment_status as (\n        select org, course_key, actor_id, MAX(emission_time) as max_emission_time\n        from reporting.fact_enrollment_status\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n            {% if filter_values(\"username\") != [] or filter_values(\n                \"name\"\n            ) != [] or filter_values(\"email\") != [] %}\n                and actor_id in (\n                    select external_user_id::String\n                    from event_sink.user_pii\n                    where\n                        1 = 1\n                        {% if filter_values(\"username\") != [] %}\n                            and username in {{ filter_values(\"username\") | where_in }}\n                        {% endif %}\n                        {% if filter_values(\"name\") != [] %}\n                            and name in {{ filter_values(\"name\") | where_in }}\n                        {% endif %}\n                        {% if filter_values(\"email\") != [] %}\n                            and email in {{ filter_values(\"email\") | where_in }}\n                        {% endif %}\n                )\n            {% endif %}\n        group by org, course_key, actor_id\n    ),\n    student_status as (\n        select\n            fss.org as org,\n            fss.course_key as course_key,\n            fss.actor_id as actor_id,\n            fss.course_name as course_name,\n            fss.course_run as course_run,\n            fss.approving_state as approving_state,\n            fss.enrollment_mode as enrollment_mode,\n            fss.enrollment_status as enrollment_status,\n            fss.course_grade as course_grade,\n            fss.grade_bucket as grade_bucket,\n            fss.username as username,\n            fss.name as name,\n            fss.email as email,\n            fss.enrolled_at as enrolled_at\n        from reporting.fact_student_status fss\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n            {% if filter_values(\"username\") != [] or filter_values(\n                \"name\"\n            ) != [] or filter_values(\"email\") != [] %}\n                and actor_id in (\n                    select external_user_id::String\n                    from event_sink.user_pii\n                    where\n                        1 = 1\n                        {% if filter_values(\"username\") != [] %}\n                            and username in {{ filter_values(\"username\") | where_in }}\n                        {% endif %}\n                        {% if filter_values(\"name\") != [] %}\n                            and name in {{ filter_values(\"name\") | where_in }}\n                        {% endif %}\n                        {% if filter_values(\"email\") != [] %}\n                            and email in {{ filter_values(\"email\") | where_in }}\n                        {% endif %}\n                )\n            {% endif %}\n    )\nselect\n    fss.org as org,\n    fss.course_key as course_key,\n    fss.actor_id as actor_id,\n    fss.course_name as course_name,\n    fss.course_run as course_run,\n    fss.approving_state as approving_state,\n    fss.enrollment_mode as enrollment_mode,\n    fss.enrollment_status as enrollment_status,\n    fss.course_grade as course_grade,\n    fss.grade_bucket as grade_bucket,\n    fss.username as username,\n    fss.name as name,\n    fss.email as email,\n    fes.max_emission_time as emission_time,\n    GREATEST(let.last_visited, fss.enrolled_at) as last_visited\nfrom student_status fss\nleft join\n    enrollment_status fes\n    on fss.org = fes.org\n    and fss.course_key = fes.course_key\n    and fss.actor_id = fes.actor_id\nleft join\n    latest_emission_time let\n    on fss.org = let.org\n    and fss.course_key = let.course_key\n    and fss.actor_id = let.actor_id\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[learner_summary_tr_TR](id:284)',1,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]',NULL,_binary '-™\‡\–NßY*¨∑\◊ﬁ™(Ø∂',0,NULL,0,0),('2025-01-10 06:45:12','2025-01-14 07:52:49',285,'fact_at_risk_pageview_engagement',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','select fact_pageview_engagement.*\nfrom reporting.fact_pageview_engagement\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners using (org, course_key, actor_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_pageview_engagement](id:285)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary '\›b1ZBØM–¢E\Ã\‰¨=è',0,NULL,1,0),('2025-01-10 06:45:13','2025-01-14 07:52:49',286,'course_information','emission_time',NULL,1,1,1,0,NULL,0,NULL,'reporting','select\n    fes.org as org,\n    cn.course_name as course_name,\n    course_run,\n    fes.actor_id as actor_id,\n    fes.enrollment_mode as enrollment_mode,\n    case\n        when flfc.emission_time >= subtractDays(now(), 7) then actor_id else null\n    end as active_learner,\n    tag as course_tag,\n    fes.course_key as course_key\nfrom reporting.fact_enrollment_status fes\nleft join\n    xapi.fact_learner_last_course_visit flfc\n    on fes.org = flfc.org\n    and fes.course_key = flfc.course_key\n    and fes.actor_id = flfc.actor_id\nleft join\n    event_sink.course_names cn on fes.org = cn.org and fes.course_key = cn.course_key\nleft join reporting.most_recent_course_tags mrct on mrct.course_key = fes.course_key\nwhere\n    enrollment_status = \'registered\'\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[course_information](id:286)',1,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]',NULL,_binary '\'§GkZöOƒ¨u\⁄RR#A',0,NULL,0,0),('2025-01-10 06:45:13','2025-01-14 07:52:49',287,'fact_at_risk_navigation_completion_ar','visited_on',NULL,1,1,1,0,NULL,0,NULL,'reporting','select fnc.*\nfrom reporting.fact_navigation_completion fnc\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners using (org, course_key, actor_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_navigation_completion_ar](id:287)',1,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]',NULL,_binary '\ŸZë{\√\\Pü\›˝´_\⁄r6',0,NULL,0,0),('2025-01-10 06:45:13','2025-01-14 07:52:49',288,'tag_filter_th',NULL,NULL,1,1,1,0,NULL,0,NULL,'event_sink','select id, rownum, tag, course_key\nfrom\n    (\n        select\n            id,\n            multiIf(parent = 0, id, CAST(parent, \'int\')) as sort_order_1,\n            multiIf(parent = 0, 0, 1) as sort_order_2,\n            concat(repeat(\'- \', countMatches(lineage, \',\')), value) as tag,\n            row_number() over (\n                order by sort_order_1 ASC, sort_order_2 ASC, value ASC\n            ) as rownum\n        from event_sink.most_recent_tags\n    ) as t\nleft join reporting.most_recent_course_tags ct on ct.tag_id = t.id\n',NULL,'[OpenedX Clickhouse].[tag_filter_th](id:288)',1,NULL,0,NULL,'[OpenedX Clickhouse].[event_sink]',NULL,_binary 'e©o\‚\“\\†®Ä\ÔiΩ<ÜA',0,NULL,0,0),('2025-01-10 06:45:13','2025-01-14 07:52:49',289,'fact_enrollment_pii_tr_TR',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    enrollments as (\n        select\n            enrollment.actor_id,\n            enrollment.course_key,\n            enrollment.org,\n            course_names.course_name as course_name\n        from reporting.fact_enrollment_status enrollment\n        inner join\n            event_sink.course_names as course_names\n            -- Need to cast the course key to a string here otherwise the\n            -- course_names dictionary throws this:\n            -- Key type for complex key at position 0 does not match, expected String,\n            -- found LowCardinality(String).\n            on course_names.course_key = enrollment.course_key::String\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    )\n\nselect\n    users.username as username,\n    users.email as email,\n    users.name as name,\n    enrollments.org as org,\n    enrollments.course_key as course_key,\n    enrollments.course_name as course_name\nfrom enrollments\ninner join\n    reporting.dim_user_pii as users\n    on (\n        enrollments.actor_id like \'mailto:%\'\n        and SUBSTRING(enrollments.actor_id, 8) = users.email\n    )\n    or enrollments.actor_id = toString(users.external_user_id)\n',NULL,'[OpenedX Clickhouse].[fact_enrollment_pii_tr_TR](id:289)',1,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]',NULL,_binary 's˚i\Ò\Â1Xø¥\◊Îäò',0,NULL,0,0),('2025-01-10 06:45:13','2025-01-14 07:52:49',290,'clickhouse_computed_metrics_fr_CA',NULL,NULL,1,1,1,0,NULL,0,NULL,'system','select name, toFloat64(value) as value, description\nfrom system.metrics\nwhere metric in (\'Query\', \'DelayedInserts\', \'DistributedFilesToInsert\')\n\nunion all\n\nselect metric as name, round(toFloat64(value), 2) as value, description\nfrom system.asynchronous_metrics\nwhere metric in (\'MaxPartCountForPartition\', \'Uptime\')\n\nunion all\n\nselect name, toFloat64(value) as value, description\nfrom system.events\nwhere\n    event in (\n        \'RejectedInserts\',\n        \'ReplicatedDataLoss\',\n        \'DataAfterMergeDiffersFromReplica\',\n        \'DataAfterMutationDiffersFromReplica\'\n    )\n\nunion all\n\nselect\n    \'StuckReplicationTasks\' as name,\n    toFloat64(count()) as value,\n    \'Replication tasks that were retried or postponed over 100 times.\' as description\nfrom system.replication_queue\nwhere num_tries > 100 or num_postponed > 100\n\nunion all\n\nselect\n    CONCAT(\'cluster \', name) as name,\n    ROUND(SUM(free_space) / SUM(total_space), 3) * 100 as value,\n    \'Free space per cluster node, as percent\' as description\nfrom system.disks\ngroup by name\n',NULL,'[OpenedX Clickhouse].[clickhouse_computed_metrics_fr_CA](id:290)',1,NULL,0,NULL,'[OpenedX Clickhouse].[system]','{}',_binary 'i\\0ÉQÂÖ∫H¡\ÕR.',0,NULL,0,0),('2025-01-10 06:45:13','2025-01-14 07:52:49',291,'fact_at_risk_pageview_engagement_en',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','select fact_pageview_engagement.*\nfrom reporting.fact_pageview_engagement\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n               
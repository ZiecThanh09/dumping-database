                  from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    )\n\nselect\n    org,\n    course_key,\n    course_name,\n    course_run,\n    section_with_name,\n    subsection_with_name,\n    video_name,\n    video_name_with_location,\n    video_id,\n    concat(\n        \'<a href=\"\', object_id, \'\" target=\"_blank\">\', video_name_with_location, \'</a>\'\n    ) as video_link,\n    actor_id,\n    started_at,\n    arrayJoin(range(start_position, end_position, 5)) as segment_start,\n    video_duration,\n    CONCAT(toString(segment_start), \'-\', toString(segment_start + 4)) as segment_range,\n    start_position,\n    username,\n    name,\n    email\nfrom enriched_segments\nleft outer join\n    reporting.dim_user_pii users\n    on (actor_id like \'mailto:%\' and SUBSTRING(actor_id, 8) = users.email)\n    or actor_id = toString(users.external_user_id)\norder by segment_start\n',NULL,'[OpenedX Clickhouse].[fact_watched_video_segments_hi](id:602)',0,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]','{}',_binary 'wû\Î\ÓûV?≥ú\Õ+†ZB',0,NULL,1,0),('2025-01-10 06:45:43','2025-01-14 07:53:11',603,'fact_navigation_completion_zh_CN','visited_on',NULL,1,1,1,0,NULL,0,NULL,'reporting','select *\nfrom reporting.fact_navigation_completion\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_navigation_completion_zh_CN](id:603)',1,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]',NULL,_binary '{Z9êªWÄçiòJEE3\ﬂ',0,NULL,0,0),('2025-01-10 06:45:43','2025-01-14 07:53:11',604,'fact_problem_engagement_de_DE',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    subsection_engagement as (\n        select\n            org,\n            course_key,\n            \'subsection\' as content_level,\n            actor_id,\n            subsection_block_id as block_id,\n            engagement_level as section_subsection_problem_engagement\n        from xapi.subsection_problem_engagement\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n\n    ),\n    section_engagement as (\n        select\n            org,\n            course_key,\n            \'section\' as content_level,\n            actor_id,\n            section_block_id as block_id,\n            engagement_level as section_subsection_problem_engagement\n        from xapi.section_problem_engagement\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ),\n    problem_engagement as (\n        select *\n        from subsection_engagement\n        union all\n        select *\n        from section_engagement\n    )\nselect\n    pe.org as org,\n    pe.course_key as course_key,\n    course_blocks.course_run as course_run,\n    course_blocks.display_name_with_location as section_subsection_name,\n    pe.content_level as content_level,\n    pe.actor_id as actor_id,\n    pe.section_subsection_problem_engagement as section_subsection_problem_engagement,\n    users.username as username,\n    users.name as name,\n    users.email as email\nfrom problem_engagement pe\njoin\n    reporting.dim_course_blocks course_blocks\n    on (\n        pe.org = course_blocks.org\n        and pe.course_key = course_blocks.course_key\n        and pe.block_id = course_blocks.block_id\n    )\nleft outer join\n    reporting.dim_user_pii users\n    on (pe.actor_id like \'mailto:%\' and SUBSTRING(pe.actor_id, 8) = users.email)\n    or pe.actor_id = toString(users.external_user_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_problem_engagement_de_DE](id:604)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary 'ü\ﬁ–áµ\ZRdµ¿üàùujõ',0,NULL,1,0),('2025-01-10 06:45:43','2025-01-14 07:53:11',605,'fact_enrollments_en','emission_time',NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    enrollments_base as (\n        select *\n        from reporting.fact_enrollments\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    )\n\nselect\n    emission_time,\n    org,\n    course_key,\n    course_name,\n    course_run,\n    actor_id,\n    enrollment_mode,\n    enrollment_status\nfrom enrollments_base\n',NULL,'[OpenedX Clickhouse].[fact_enrollments_en](id:605)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]','{}',_binary 'Bj\“\Û•7]ßÄ\Ê¢k?í\Ÿ',0,NULL,1,0),('2025-01-10 06:45:43','2025-01-14 07:53:11',606,'slowest_clickhouse_queries','event_time',NULL,1,1,1,0,NULL,0,NULL,'system','select\n    event_time,\n    query_duration_ms / 1000 as duration_secs,\n    read_rows,\n    memory_usage / 1024 as memory_usage_kb,\n    query\nfrom system.query_log\nwhere type = \'QueryFinish\'\norder by query_duration_ms DESC\n;\n',NULL,'[OpenedX Clickhouse].[slowest_clickhouse_queries](id:606)',1,NULL,0,NULL,'[OpenedX Clickhouse].[system]','{}',_binary 'j\◊\Ô8µÄ^∑îXÜ\Za\ÕP)',0,NULL,0,0),('2025-01-10 06:45:43','2025-01-14 07:53:11',607,'tag_filter_es_ES',NULL,NULL,1,1,1,0,NULL,0,NULL,'event_sink','select id, rownum, tag, course_key\nfrom\n    (\n        select\n            id,\n            multiIf(parent = 0, id, CAST(parent, \'int\')) as sort_order_1,\n            multiIf(parent = 0, 0, 1) as sort_order_2,\n            concat(repeat(\'- \', countMatches(lineage, \',\')), value) as tag,\n            row_number() over (\n                order by sort_order_1 ASC, sort_order_2 ASC, value ASC\n            ) as rownum\n        from event_sink.most_recent_tags\n    ) as t\nleft join reporting.most_recent_course_tags ct on ct.tag_id = t.id\n',NULL,'[OpenedX Clickhouse].[tag_filter_es_ES](id:607)',1,NULL,0,NULL,'[OpenedX Clickhouse].[event_sink]',NULL,_binary 'øN\Á\»[^êë\Ô\…±\·y•',0,NULL,0,0),('2025-01-10 06:45:43','2025-01-14 07:53:11',608,'course_overviews',NULL,NULL,1,1,1,0,NULL,0,NULL,'event_sink','select * from event_sink.course_overviews\n',NULL,'[OpenedX Clickhouse].[course_overviews](id:608)',0,NULL,0,NULL,'[OpenedX Clickhouse].[event_sink]','{}',_binary '´Yà\ı¿ZZÜ)x’å\Ÿ\Â\Ú',0,NULL,1,0),('2025-01-10 06:45:44','2025-01-14 07:53:11',609,'fact_navigation_completion','visited_on',NULL,1,1,1,0,NULL,0,NULL,'reporting','select *\nfrom reporting.fact_navigation_completion\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_navigation_completion](id:609)',1,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]',NULL,_binary 'ø\nìBQ≠RrL/êÆ',0,NULL,0,0),('2025-01-10 06:45:44','2025-01-14 07:53:11',610,'fact_student_status_plus_7_days_da','enrolled_at',NULL,1,1,1,0,NULL,0,NULL,NULL,'with\n    recent_activity as (\n        select course_key, COUNT(DISTINCT actor_id) as active_last_7_days\n        from xapi.navigation_events\n        where\n            emission_time >= NOW() - INTERVAL 7 DAY\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n        group by course_key\n    )\n\nselect fss.*, COALESCE(ra.active_last_7_days, 0) as active_within_last_7_days\nfrom reporting.fact_student_status fss\nleft join recent_activity ra on fss.course_key = ra.course_key\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_student_status_plus_7_days_da](id:610)',1,NULL,0,NULL,NULL,NULL,_binary 'E\ﬂ>èØ\ﬁXqöcﬁ∞ñ|<I',0,NULL,0,0),('2025-01-10 06:45:44','2025-01-14 07:53:11',611,'problem_coursewide_avg_uk','emission_time',NULL,1,1,1,0,NULL,0,NULL,NULL,'-- See int_problem_results.sql for more context\nwith\n    successful_responses as (\n        select\n            org, course_key, problem_id, actor_id::String as actor_id, first_success_at\n        from xapi.responses\n        where\n            isNotNull(first_success_at)\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ),\n    unsuccessful_responses as (\n        select\n            org,\n            course_key,\n            problem_id,\n            actor_id::String as actor_id,\n            max(last_attempt_at) as last_attempt_at\n        from xapi.responses\n        where\n            actor_id not in (select distinct actor_id from successful_responses)\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n        group by org, course_key, problem_id, actor_id\n    ),\n    responses as (\n        select org, course_key, problem_id, actor_id, first_success_at as emission_time\n        from successful_responses\n        union all\n        select org, course_key, problem_id, actor_id, last_attempt_at as emission_time\n        from unsuccessful_responses\n    ),\n    full_responses as (\n        select\n            events.emission_time as emission_time,\n            events.org as org,\n            events.course_key as course_key,\n            events.problem_id as problem_id,\n            events.object_id as object_id,\n            events.actor_id as actor_id,\n            events.responses as responses,\n            events.success as success,\n            events.attempts as attempts,\n            events.interaction_type as interaction_type\n        from xapi.problem_events events\n        join responses using (org, course_key, problem_id, actor_id, emission_time)\n    ),\n    -- Aggregating course-wide averages and percentages\n    coursewide_attempts as (\n        select\n            org,\n            course_key,\n            problem_id,\n            avg(case when success then attempts else 0 end) as avg_correct_attempts,\n            avg(\n                case when not success then attempts else 0 end\n            ) as avg_incorrect_attempts,\n            sum(case when success then 1 else 0 end)::float\n            / count(*) as coursewide_percent_correct\n        from full_responses\n        group by org, course_key, problem_id\n    )\n\nselect\n    full_responses.emission_time as emission_time,\n    full_responses.org as org,\n    full_responses.course_key as course_key,\n    blocks.course_name as course_name,\n    blocks.course_run as course_run,\n    full_responses.problem_id as problem_id,\n    blocks.block_name as problem_name,\n    blocks.display_name_with_location as problem_name_with_location,\n    blocks.course_order as course_order,\n    concat(\n        \'<a href=\"\',\n        full_responses.object_id,\n        \'\" target=\"_blank\">\',\n        problem_name_with_location,\n        \'</a>\'\n    ) as problem_link,\n    full_responses.actor_id as actor_id,\n    full_responses.responses as responses,\n    full_responses.success as success,\n    full_responses.attempts as attempts,\n    full_responses.interaction_type as interaction_type,\n    blocks.graded as graded,\n    users.username as username,\n    users.email as email,\n    users.name as name,\n    -- Aggregated values from the coursewide_attempts CTE\n    coursewide_attempts.avg_correct_attempts as avg_correct_attempts_coursewide,\n    coursewide_attempts.avg_incorrect_attempts as avg_incorrect_attempts_coursewide,\n    coursewide_attempts.coursewide_percent_correct as coursewide_percent_correct,\n    -- Learner-specific calculations (correcting the percentage calculations)\n    (\n        case when full_responses.success then full_responses.attempts else 0 end\n    ) as correct_attempts_by_learner,\n    (\n        case when not full_responses.success then full_responses.attempts else 0 end\n    ) as incorrect_attempts_by_learner,\n    -- Ensure we calculate percentage based on total attempts per problem (multiplied\n    -- by 100 only once)\n    (\n        sum(case when full_responses.success then 1 else 0 end) over (\n            partition by full_responses.actor_id, full_responses.problem_id\n        ) / count(*) over (\n            partition by full_responses.actor_id, full_responses.problem_id\n        )\n    ) as selected_learner_percent_correct,\n    (\n        sum(case when not full_responses.success then 1 else 0 end) over (\n            partition by full_responses.actor_id, full_responses.problem_id\n        ) / count(*) over (\n            partition by full_responses.actor_id, full_responses.problem_id\n        )\n    ) as selected_learner_percent_incorrect\nfrom full_responses\njoin\n    reporting.dim_course_blocks blocks\n    on (\n        full_responses.course_key = blocks.course_key\n        and full_responses.problem_id = blocks.block_id\n    )\nleft outer join\n    event_sink.user_pii users\n    on (\n        full_responses.actor_id like \'mailto:%\'\n        and SUBSTRING(full_responses.actor_id, 8) = users.email\n    )\n    or full_responses.actor_id = toString(users.external_user_id)\njoin\n    coursewide_attempts\n    on full_responses.org = coursewide_attempts.org\n    and full_responses.course_key = coursewide_attempts.course_key\n    and full_responses.problem_id = coursewide_attempts.problem_id\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[problem_coursewide_avg_uk](id:611)',1,NULL,0,NULL,NULL,NULL,_binary 'h\ÓyüßW!óCî˘\“',0,NULL,0,0),('2025-01-10 06:45:44','2025-01-14 07:53:11',612,'ab_user_he','last_login',NULL,2,1,1,0,NULL,0,NULL,'superset','select * from superset.ab_user\n',NULL,'[Superset Metadata].[ab_user_he](id:612)',0,NULL,0,NULL,'[Superset Metadata].[superset]','{}',_binary '@\›\ZÜìV\nôÅ}oJ\n&',0,NULL,0,0),('2025-01-10 06:45:44','2025-01-14 07:53:11',613,'fact_problem_engagement_es_419',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    subsection_engagement as (\n        select\n            org,\n            course_key,\n            \'subsection\' as content_level,\n            actor_id,\n            subsection_block_id as block_id,\n            engagement_level as section_subsection_problem_engagement\n        from xapi.subsection_problem_engagement\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n\n    ),\n    section_engagement as (\n        select\n            org,\n            course_key,\n            \'section\' as content_level,\n            actor_id,\n            section_block_id as block_id,\n            engagement_level as section_subsection_problem_engagement\n        from xapi.section_problem_engagement\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ),\n    problem_engagement as (\n        select *\n        from subsection_engagement\n        union all\n        select *\n        from section_engagement\n    )\nselect\n    pe.org as org,\n    pe.course_key as course_key,\n    course_blocks.course_run as course_run,\n    course_blocks.display_name_with_location as section_subsection_name,\n    pe.content_level as content_level,\n    pe.actor_id as actor_id,\n    pe.section_subsection_problem_engagement as section_subsection_problem_engagement,\n    users.username as username,\n    users.name as name,\n    users.email as email\nfrom problem_engagement pe\njoin\n    reporting.dim_course_blocks course_blocks\n    on (\n        pe.org = course_blocks.org\n        and pe.course_key = course_blocks.course_key\n        and pe.block_id = course_blocks.block_id\n    )\nleft outer join\n    reporting.dim_user_pii users\n    on (pe.actor_id like \'mailto:%\' and SUBSTRING(pe.actor_id, 8) = users.email)\n    or pe.actor_id = toString(users.external_user_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_problem_engagement_es_419](id:613)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary 'H=˝Lfó\\xáDúC_v.',0,NULL,1,0),('2025-01-10 06:45:44','2025-01-14 07:53:11',614,'dim_at_risk_learners_id',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    page_visits as (\n        select org, course_key, actor_id, max(emission_time) as last_visited\n        from xapi.fact_learner_last_course_visit\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n            and emission_time < subtractDays(now(), 7)\n        group by org, course_key, actor_id\n    )\n\nselect\n    learners.org as org,\n    learners.course_key as course_key,\n    learners.course_name as course_name,\n    learners.course_run as course_run,\n    learners.actor_id as actor_id,\n    learners.username as username,\n    learners.name as name,\n    learners.email as email,\n    learners.enrollment_mode as enrollment_mode,\n    learners.course_grade as course_grade,\n    learners.enrolled_at as enrolled_at,\n    learners.grade_bucket as grade_bucket,\n    page_visits.last_visited as last_visited\nfrom reporting.fact_student_status learners\njoin page_visits using (org, course_key, actor_id)\nwhere\n    approving_state = \'failed\'\n    and enrollment_status = \'registered\'\n    and page_visits.last_visited < subtractDays(now(), 7)\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[dim_at_risk_learners_id](id:614)',0,NULL,0,'{}','[OpenedX Clickhouse].[reporting]',NULL,_binary 'Wë\‹\ÓY\'ó	\Œ-∂_ ',0,NULL,1,0),('2025-01-10 06:45:44','2025-01-14 07:53:11',615,'course_names_pt_BR',NULL,NULL,1,1,1,0,NULL,0,NULL,'event_sink','select * from event_sink.course_names\n',NULL,'[OpenedX Clickhouse].[course_names_pt_BR](id:615)',0,NULL,0,NULL,'[OpenedX Clickhouse].[event_sink]','{}',_binary '\nπ@â¡+[ôû≥p⁄ÅB\ﬂ',0,NULL,1,0),('2025-01-10 06:45:44','2025-01-14 07:53:11',616,'fact_student_status_plus_7_days_th','enrolled_at',NULL,1,1,1,0,NULL,0,NULL,NULL,'with\n    recent_activity as (\n        select course_key, COUNT(DISTINCT actor_id) as active_last_7_days\n        from xapi.navigation_events\n        where\n            emission_time >= NOW() - INTERVAL 7 DAY\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n        group by course_key\n    )\n\nselect fss.*, COALESCE(ra.active_last_7_days, 0) as active_within_last_7_days\nfrom reporting.fact_student_status fss\nleft join recent_activity ra on fss.course_key = ra.course_key\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_student_status_plus_7_days_th](id:616)',1,NULL,0,NULL,NULL,NULL,_binary '\⁄_¿Cπº\\T≠j>R6\Ú\∆\È',0,NULL,0,0),('2025-01-10 06:45:44','2025-01-14 07:53:11',617,'fact_at_risk_video_watches_pt_BR',NULL,NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    watches as (\n        with\n            watched_segments as (\n                with\n                    video_events as (\n                        select\n                            emission_time,\n                            org,\n                            course_key,\n                            splitByString(\'/xblock/\', object_id)[-1] as video_id,\n                            object_id,\n                            actor_id,\n                            verb_id,\n                            video_position,\n                            video_duration\n                        from xapi.video_playback_events\n                        where\n                            1 = 1\n                            {% if filter_values(\"org\") != [] %}\n                                and org in {{ filter_values(\"org\") | where_in }}\n                            {% endif %}\n\n                            {% if filter_values(\"course_name\") != [] %}\n                                and course_key in (\n                                    select course_key\n                                    from event_sink.course_names\n                                    where\n                                        course_name\n                                        in {{ filter_values(\"course_name\") | where_in }}\n                                )\n                            {% endif %}\n\n                            {% if filter_values(\"tag\") != [] %}\n                                and course_key in (\n                                    select course_key\n                                    from reporting.most_recent_course_tags\n                                    where\n                                        tag in (\n                                            select\n                                                replaceAll(\n                                                    arrayJoin(\n                                                        {{ filter_values(\"tag\") }}\n                                                    ),\n                                                    \'- \',\n                                                    \'\'\n                                                )\n                                        )\n                                )\n                            {% endif %}\n                    ),\n                    starts as (\n                        select *\n                        from video_events\n                        where verb_id = \'https://w3id.org/xapi/video/verbs/played\'\n                    ),\n                    ends as (\n                        select *\n                        from video_events\n                        where\n                            verb_id in (\n                                \'http://adlnet.gov/expapi/verbs/completed\',\n                                \'https://w3id.org/xapi/video/verbs/seeked\',\n                                \'https://w3id.org/xapi/video/verbs/paused\',\n                                \'http://adlnet.gov/expapi/verbs/terminated\'\n                            )\n                    ),\n                    segments as (\n                        select\n                            starts.org as org,\n                            starts.course_key as course_key,\n                            starts.video_id as video_id,\n                            starts.actor_id,\n                            starts.object_id as object_id,\n                            cast(starts.video_position as Int32) as start_position,\n                            cast(ends.video_position as Int32) as end_position,\n                            starts.emission_time as started_at,\n                            ends.emission_time as ended_at,\n                            ends.verb_id as end_type,\n                            starts.video_duration as video_duration\n                        from starts left\n                        asof join\n                            ends\n                            on (\n                                starts.org = ends.org\n                                and starts.course_key = ends.course_key\n                                and starts.video_id = ends.video_id\n                                and starts.actor_id = ends.actor_id\n                                and starts.emission_time < ends.emission_time\n                            )\n                    ),\n                    enriched_segments as (\n                        select\n                            segments.org as org,\n                            segments.course_key as course_key,\n                            blocks.course_name as course_name,\n                            blocks.course_run as course_run,\n                            blocks.section_with_name as section_with_name,\n                            blocks.subsection_with_name as subsection_with_name,\n                            blocks.block_name as video_name,\n                            blocks.display_name_with_location\n                            as video_name_with_location,\n                            segments.actor_id as actor_id,\n                            segments.object_id as object_id,\n                            segments.started_at as started_at,\n                            segments.start_position\n                            - (segments.start_position % 5) as start_position,\n                            segments.end_position\n                            - (segments.end_position % 5) as end_position,\n                            segments.video_duration as video_duration,\n                            segments.video_id as video_id\n                        from segments\n                        join\n                            reporting.dim_course_blocks_extended blocks\n                            on (\n                                segments.course_key = blocks.course_key\n                                and segments.video_id = blocks.block_id\n                            )\n                        where\n                            1 = 1\n                            {% if filter_values(\"org\") != [] %}\n                                and org in {{ filter_values(\"org\") | where_in }}\n                            {% endif %}\n\n                            {% if filter_values(\"course_name\") != [] %}\n                                and course_key in (\n                                    select course_key\n                                    from event_sink.course_names\n                                    where\n                                        course_name\n                                        in {{ filter_values(\"course_name\") | where_in }}\n                                )\n                            {% endif %}\n\n                            {% if filter_values(\"tag\") != [] %}\n                                and course_key in (\n                                    select course_key\n                                    from reporting.most_recent_course_tags\n                                    where\n                                        tag in (\n                                            select\n                                                replaceAll(\n                                                    arrayJoin(\n                                                        {{ filter_values(\"tag\") }}\n                                                    ),\n                                                    \'- \',\n                                                    \'\'\n                                                )\n                                        )\n                                )\n                            {% endif %}\n                    )\n\n                select\n                    org,\n                    course_key,\n                    course_name,\n                    course_run,\n                    section_with_name,\n                    subsection_with_name,\n                    video_name,\n                    video_name_with_location,\n                    video_id,\n                    concat(\n                        \'<a href=\"\',\n                        object_id,\n                        \'\" target=\"_blank\">\',\n                        video_name_with_location,\n                        \'</a>\'\n                    ) as video_link,\n                    actor_id,\n                    started_at,\n                    arrayJoin(range(start_position, end_position, 5)) as segment_start,\n                    video_duration,\n                    CONCAT(\n                        toString(segment_start), \'-\', toString(segment_start + 4)\n                    ) as segment_range,\n                    start_position,\n                    username,\n                    name,\n                    email\n                from enriched_segments\n                left outer join\n                    reporting.dim_user_pii users\n                    on (\n                        actor_id like \'mailto:%\'\n                        and SUBSTRING(actor_id, 8) = users.email\n                    )\n                    or actor_id = toString(users.external_user_id)\n                order by segment_start\n            )\n\n        select\n            org,\n            course_key,\n            course_name,\n            course_run,\n            section_with_name,\n            subsection_with_name,\n            video_name,\n            video_name_with_location,\n            video_link,\n            actor_id,\n            username,\n            email,\n            name,\n            count(distinct segment_start) as watched_segment_count,\n            (video_duration - 10) / 5 as video_segment_count,\n            video_segment_count <= watched_segment_count as watched_entire_video\n        from watched_segments\n        where\n            1 = 1\n\n            {% if filter_values(\"Section Name\") != [] %}\n                and section_with_name in {{ filter_values(\"Section Name\") | where_in }}\n            {% endif %}\n            {% if filter_values(\"Subsection Name\") != [] %}\n                and subsection_with_name\n                in {{ filter_values(\"Subsection Name\") | where_in }}\n            {% endif %}\n            {% if from_dttm %} and started_at > \'{{ from_dttm }}\' {% endif %}\n            {% if to_dttm %} and started_at < \'{{ to_dttm }}\' {% endif %}\n\n        group by\n            org,\n            course_key,\n            course_name,\n            course_run,\n            section_with_name,\n            subsection_with_name,\n            video_name,\n            video_name_with_location,\n            video_link,\n            actor_id,\n            video_id,\n            video_segment_count,\n            username,\n            email,\n            name\n    )\n\nselect watches.*\nfrom watches\njoin\n    (\n        with\n            page_visits as (\n                select org, course_key, actor_id, max(emission_time) as last_visited\n                from xapi.fact_learner_last_course_visit\n                where\n                    1 = 1\n                    {% if filter_values(\"org\") != [] %}\n                        and org in {{ filter_values(\"org\") | where_in }}\n                    {% endif %}\n\n                    {% if filter_values(\"course_name\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from event_sink.course_names\n                            where\n                                course_name\n                                in {{ filter_values(\"course_name\") | where_in }}\n                        )\n                    {% endif %}\n\n                    {% if filter_values(\"tag\") != [] %}\n                        and course_key in (\n                            select course_key\n                            from reporting.most_recent_course_tags\n                            where\n                                tag in (\n                                    select\n                                        replaceAll(\n                                            arrayJoin({{ filter_values(\"tag\") }}),\n                                            \'- \',\n                                            \'\'\n                                        )\n                                )\n                        )\n                    {% endif %}\n                    and emission_time < subtractDays(now(), 7)\n                group by org, course_key, actor_id\n            )\n\n        select org, course_key, learners.actor_id as actor_id\n        from reporting.fact_student_status learners\n        join page_visits using (org, course_key, actor_id)\n        where\n            approving_state = \'failed\' and enrollment_status = \'registered\'\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n    ) as at_risk_learners using (org, course_key, actor_id)\nwhere\n    1 = 1\n    {% if filter_values(\"org\") != [] %}\n        and org in {{ filter_values(\"org\") | where_in }}\n    {% endif %}\n\n    {% if filter_values(\"course_name\") != [] %}\n        and course_key in (\n            select course_key\n            from event_sink.course_names\n            where course_name in {{ filter_values(\"course_name\") | where_in }}\n        )\n    {% endif %}\n\n    {% if filter_values(\"tag\") != [] %}\n        and course_key in (\n            select course_key\n            from reporting.most_recent_course_tags\n            where\n                tag\n                in (select replaceAll(arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'))\n        )\n    {% endif %}\n',NULL,'[OpenedX Clickhouse].[fact_at_risk_video_watches_pt_BR](id:617)',0,NULL,0,NULL,'[OpenedX Clickhouse].[reporting]','{}',_binary 'F©≠ WG∑\€5íNöw',0,NULL,1,0),('2025-01-10 06:45:44','2025-01-14 07:53:12',618,'learner_summary_it_IT','emission_time',NULL,1,1,1,0,NULL,0,NULL,'reporting','with\n    latest_emission_time as (\n        select org, course_key, actor_id, MAX(emission_time) as last_visited\n        from xapi.fact_learner_last_course_visit\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                                    arrayJoin({{ filter_values(\"tag\") }}), \'- \', \'\'\n                                )\n                        )\n                )\n            {% endif %}\n            {% if filter_values(\"username\") != [] or filter_values(\n                \"name\"\n            ) != [] or filter_values(\"email\") != [] %}\n                and actor_id in (\n                    select external_user_id::String\n                    from event_sink.user_pii\n                    where\n                        1 = 1\n                        {% if filter_values(\"username\") != [] %}\n                            and username in {{ filter_values(\"username\") | where_in }}\n                        {% endif %}\n                        {% if filter_values(\"name\") != [] %}\n                            and name in {{ filter_values(\"name\") | where_in }}\n                        {% endif %}\n                        {% if filter_values(\"email\") != [] %}\n                            and email in {{ filter_values(\"email\") | where_in }}\n                        {% endif %}\n                )\n            {% endif %}\n        group by org, course_key, actor_id\n    ),\n    enrollment_status as (\n        select org, course_key, actor_id, MAX(emission_time) as max_emission_time\n        from reporting.fact_enrollment_status\n        where\n            1 = 1\n            {% if filter_values(\"org\") != [] %}\n                and org in {{ filter_values(\"org\") | where_in }}\n            {% endif %}\n\n            {% if filter_values(\"course_name\") != [] %}\n                and course_key in (\n                    select course_key\n                    from event_sink.course_names\n                    where course_name in {{ filter_values(\"course_name\") | where_in }}\n                )\n            {% endif %}\n\n            {% if filter_values(\"tag\") != [] %}\n                and course_key in (\n                    select course_key\n                    from reporting.most_recent_course_tags\n                    where\n                        tag in (\n                            select\n                                replaceAll(\n                         